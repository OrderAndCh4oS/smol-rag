**Title: SmolRAG API Documentation**

---

### **1. Introduction to the SmolRAG API**

The SmolRAG API provides a simple and powerful interface for interacting with SmolRAG through HTTP requests. This REST API allows you to query documents using various query types without having to directly integrate the SmolRAG Python library into your application.

The API is built using FastAPI, a modern, fast web framework for building APIs with Python. It provides automatic validation, serialization, and documentation, making it easy to use and integrate with other systems.

---

### **2. API Overview**

The SmolRAG API exposes a single endpoint for querying documents:

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/query` | POST | Process a query using SmolRAG |

This endpoint accepts a JSON payload containing the query text and optional query type, and returns a JSON response with the query result.

---

### **3. Request Format**

Requests to the `/query` endpoint should use the following format:

```json
{
  "text": "Your query text here",
  "query_type": "standard"
}
```

**Parameters**:

- `text` (string, required): The query text to process.
- `query_type` (string, optional, default: "standard"): The type of query to perform. Valid values are:
  - `standard`: Uses vector search query
  - `local_kg`: Uses local knowledge graph query
  - `global_kg`: Uses global knowledge graph query
  - `hybrid_kg`: Uses hybrid knowledge graph query
  - `mix`: Uses mix query (combines vector search and knowledge graph)

If the `query_type` parameter is omitted, the API will use the default "standard" query type.

---

### **4. Response Format**

Responses from the `/query` endpoint use the following format:

```json
{
  "result": "The response text from SmolRAG"
}
```

**Fields**:

- `result` (string): The response text generated by SmolRAG based on the query.

---

### **5. Error Handling**

The API includes robust error handling to provide clear feedback when issues occur:

**Client Errors (4xx)**:

- **400 Bad Request**: Returned when the request is invalid, such as when the query text is empty or the query type is invalid.
  ```json
  {
    "detail": "Query text cannot be empty"
  }
  ```
  or
  ```json
  {
    "detail": "Invalid query_type: unknown. Valid types are: standard, local_kg, global_kg, hybrid_kg, mix"
  }
  ```

**Server Errors (5xx)**:

- **500 Internal Server Error**: Returned when an unexpected error occurs during query processing.
  ```json
  {
    "detail": "Error message describing the issue"
  }
  ```

These error responses help diagnose and resolve issues when integrating with the API.

---

### **6. Authentication**

The SmolRAG API does not include built-in authentication by default. If you need to secure the API, you should implement authentication using FastAPI's security features or deploy the API behind an API gateway that provides authentication.

For production deployments, consider implementing one of the following authentication methods:

- **API Key**: Require an API key in the request headers.
- **OAuth 2.0**: Use OAuth 2.0 for more sophisticated authentication and authorization.
- **JWT**: Use JSON Web Tokens for stateless authentication.

Example implementation of API key authentication:

```python
from fastapi import FastAPI, Depends, HTTPException, Security
from fastapi.security.api_key import APIKeyHeader
from starlette.status import HTTP_403_FORBIDDEN

API_KEY = "your-secret-api-key"
API_KEY_NAME = "X-API-Key"

api_key_header = APIKeyHeader(name=API_KEY_NAME, auto_error=False)

async def get_api_key(api_key: str = Security(api_key_header)):
    if api_key == API_KEY:
        return api_key
    raise HTTPException(
        status_code=HTTP_403_FORBIDDEN, detail="Invalid API Key"
    )

app = FastAPI(title="SmolRag API")

@app.post("/query", dependencies=[Depends(get_api_key)])
async def query_endpoint(request: QueryRequest):
    # Process query as normal
    pass
```

---

### **7. Rate Limiting**

The SmolRAG API does not include built-in rate limiting by default. For production deployments, consider implementing rate limiting to prevent abuse and ensure fair usage of resources.

You can implement rate limiting using FastAPI middleware or deploy the API behind an API gateway that provides rate limiting capabilities.

Example implementation using the `slowapi` package:

```python
from fastapi import FastAPI
from slowapi import Limiter, _rate_limit_exceeded_handler
from slowapi.util import get_remote_address
from slowapi.errors import RateLimitExceeded

limiter = Limiter(key_func=get_remote_address)
app = FastAPI(title="SmolRag API")
app.state.limiter = limiter
app.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)

@app.post("/query")
@limiter.limit("10/minute")
async def query_endpoint(request: QueryRequest):
    # Process query as normal
    pass
```

---

### **8. CORS Configuration**

Cross-Origin Resource Sharing (CORS) allows web applications running on one domain to make requests to the API running on another domain. The SmolRAG API does not include CORS configuration by default.

For web applications that need to access the API from a browser, you should configure CORS using FastAPI's middleware:

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI(title="SmolRag API")

# Configure CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://your-frontend-domain.com"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# API endpoints
```

Adjust the `allow_origins` list to include the domains of your frontend applications.

---

### **9. API Versioning**

As your API evolves, you may need to make breaking changes while still supporting existing clients. API versioning allows you to do this by providing different versions of the API simultaneously.

You can implement versioning in FastAPI using path prefixes:

```python
from fastapi import FastAPI, APIRouter

app = FastAPI(title="SmolRag API")

# Version 1 router
v1_router = APIRouter(prefix="/v1")

@v1_router.post("/query")
async def query_endpoint_v1(request: QueryRequest):
    # Process query using v1 logic
    pass

# Version 2 router
v2_router = APIRouter(prefix="/v2")

@v2_router.post("/query")
async def query_endpoint_v2(request: QueryRequestV2):
    # Process query using v2 logic
    pass

# Include routers
app.include_router(v1_router)
app.include_router(v2_router)
```

This approach allows you to maintain backward compatibility while adding new features.

---

### **10. API Documentation with Swagger UI**

FastAPI automatically generates interactive API documentation using Swagger UI. When you run the SmolRAG API, you can access the documentation at:

- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`

These interactive documentation pages allow you to:

1. Explore the available endpoints
2. View request and response schemas
3. Test the API directly from the browser
4. Understand the validation rules and error responses

The documentation is automatically generated from the API code, ensuring it stays up-to-date with the implementation.

---

### **11. Example API Requests**

Here are examples of how to interact with the SmolRAG API using different tools:

**Using curl**:

```bash
# Standard query
curl -X POST http://localhost:8000/query \
  -H "Content-Type: application/json" \
  -d '{"text": "What is SmolRAG?", "query_type": "standard"}'

# Knowledge graph query
curl -X POST http://localhost:8000/query \
  -H "Content-Type: application/json" \
  -d '{"text": "What entities are related to document chunking?", "query_type": "local_kg"}'

# Mix query
curl -X POST http://localhost:8000/query \
  -H "Content-Type: application/json" \
  -d '{"text": "How does SmolRAG process and retrieve information?", "query_type": "mix"}'
```

**Using Python requests**:

```python
import requests
import json

url = "http://localhost:8000/query"
headers = {"Content-Type": "application/json"}

# Standard query
payload = {
    "text": "What is SmolRAG?",
    "query_type": "standard"
}
response = requests.post(url, data=json.dumps(payload), headers=headers)
print(response.json())

# Knowledge graph query
payload = {
    "text": "What entities are related to document chunking?",
    "query_type": "local_kg"
}
response = requests.post(url, data=json.dumps(payload), headers=headers)
print(response.json())

# Mix query
payload = {
    "text": "How does SmolRAG process and retrieve information?",
    "query_type": "mix"
}
response = requests.post(url, data=json.dumps(payload), headers=headers)
print(response.json())
```

**Using JavaScript fetch**:

```javascript
// Standard query
fetch('http://localhost:8000/query', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    text: 'What is SmolRAG?',
    query_type: 'standard'
  }),
})
.then(response => response.json())
.then(data => console.log(data));

// Knowledge graph query
fetch('http://localhost:8000/query', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    text: 'What entities are related to document chunking?',
    query_type: 'local_kg'
  }),
})
.then(response => response.json())
.then(data => console.log(data));

// Mix query
fetch('http://localhost:8000/query', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    text: 'How does SmolRAG process and retrieve information?',
    query_type: 'mix'
  }),
})
.then(response => response.json())
.then(data => console.log(data));
```

---

### **12. Deployment Considerations**

When deploying the SmolRAG API to production, consider the following:

**Server Options**:
- **Uvicorn**: A lightweight ASGI server suitable for development and small deployments.
  ```bash
  uvicorn api.main:app --host 0.0.0.0 --port 8000
  ```
- **Gunicorn with Uvicorn Workers**: For production deployments with multiple workers.
  ```bash
  gunicorn api.main:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000
  ```
- **Docker**: Containerize the API for consistent deployment across environments.
  ```bash
  docker build -t smol-rag .
  docker run -p 8000:8000 --env-file .env smol-rag
  ```

**Performance Optimization**:
- Use a production-grade ASGI server like Uvicorn with Gunicorn
- Implement caching for frequent queries
- Consider horizontal scaling for high-traffic deployments
- Monitor memory usage, as the vector store and knowledge graph can consume significant memory

**Security**:
- Implement authentication and authorization
- Use HTTPS in production
- Regularly update dependencies
- Implement proper input validation and sanitization

**Monitoring**:
- Set up logging to track API usage and errors
- Implement health check endpoints
- Use monitoring tools to track performance and availability

---

### **13. Extending the API**

The SmolRAG API can be extended to provide additional functionality:

**Additional Endpoints**:
- **Document Management**: Add endpoints for adding, updating, and removing documents.
  ```python
  @app.post("/documents")
  async def add_document(document: DocumentRequest):
      # Add document logic
      pass
  
  @app.delete("/documents/{document_id}")
  async def remove_document(document_id: str):
      # Remove document logic
      pass
  ```

- **System Information**: Add endpoints for retrieving information about the system.
  ```python
  @app.get("/info")
  async def get_info():
      # Return system information
      pass
  ```

**Asynchronous Processing**:
- For long-running queries, implement asynchronous processing with background tasks.
  ```python
  from fastapi import BackgroundTasks
  
  @app.post("/query/async")
  async def async_query(request: QueryRequest, background_tasks: BackgroundTasks):
      # Start query in background
      background_tasks.add_task(process_query, request)
      return {"status": "processing", "query_id": query_id}
  
  @app.get("/query/result/{query_id}")
  async def get_query_result(query_id: str):
      # Return result if available
      pass
  ```

**Webhooks**:
- Implement webhooks for notifying external systems when queries are completed.
  ```python
  @app.post("/query/webhook")
  async def webhook_query(request: WebhookQueryRequest):
      # Process query and send result to webhook URL
      pass
  ```

---

### **14. Conclusion**

The SmolRAG API provides a simple yet powerful interface for querying documents using various retrieval methods. By following RESTful principles and leveraging FastAPI's capabilities, the API offers a clean, well-documented, and easy-to-use interface for integrating SmolRAG into your applications.

Whether you're building a web application, mobile app, or integrating with other systems, the SmolRAG API provides the flexibility and functionality you need to leverage the power of retrieval-augmented generation.